import{r as x,j as e,c as D,a as $,B as A,P as M,b as L,T,d as P,e as v,m as I,f as E,_ as B,g as O,R as W,h as b}from"./index-83851eea.js";import{I as F}from"./Input-7d72c842.js";import{M as q}from"./MoonLoader-c1b394fd.js";import{F as j}from"./fetchKeys-14f763aa.js";import{u as Y}from"./useUserProfile-06baff68.js";import H from"./index-b4f6960b.js";import"./useIsUserLoggedIn-78c27713.js";function J({children:t,className:s,...a},l){return e.jsx("dialog",{ref:l,className:D("min-h-64 min-w-80 ",s),...a,children:t})}const K=x.forwardRef(J);function V({children:t,title:s,classNameTitle:a,...l},r){return e.jsxs(K,{ref:r,...l,children:[e.jsxs("div",{className:D("relative font-bold w-full py-2 text-xl text-center text-slate-300 tracking-wide bg-slate-800/50",a),children:[s,e.jsx("button",{onClick:()=>r.current.close(),className:"absolute top-0 right-0 flex items-center h-full mr-2 text-xl",children:e.jsx($,{className:"w-6 h-6 hover:text-red-600"})})]}),t]})}const G=x.forwardRef(V);function Q(){const t=x.useRef();return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"w-full m-3",children:[e.jsx(F,{type:"search",placeholder:"ðŸ”Ž search"}),e.jsxs(A,{onClick:()=>{t.current.showModal()},className:"px-5 float-right",children:[e.jsx(M,{})," â€‚ Add"]})]}),e.jsx(G,{className:"p-5 bg-zinc-950",classNameTitle:"bg-transparent",title:"Add Playlist",ref:t,children:e.jsx(X,{onSubmit:()=>t.current.close()})}),e.jsx(Z,{})]})}const C={playlistName:""};function X({onSubmit:t}){const[s,a]=x.useState(C),[l,r]=x.useState(!1),[i,o]=x.useState();function m(h){a(c=>({...c,[h.target.name]:h.target.value}))}function p(h){h.preventDefault(),h.stopPropagation(),s.playlistName&&(r(!0),v.post("/music/playlist",{playlistName:s.playlistName}).then(c=>{var n,u;if(((n=c.data)==null?void 0:n.responseCode)!==1)throw new Error((u=c.data)==null?void 0:u.message);a(C),I(j.publicPlaylists),o(),t&&t(c)}).catch(c=>{o(c.message)}).finally(()=>{r(!1)}))}return e.jsxs("form",{onSubmit:p,className:"flex flex-col justify-center gap-8 mt-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"bg-slate-500/10 py-4 text-center text-xl",type:"text",name:"playlistName",value:s.playlistName,placeholder:"Playlist Name",maxLength:20,minLength:1,onChange:m,required:!0}),i&&e.jsx("p",{className:"text-sm text-red-700 text-wrap",children:i})]}),e.jsx(A,{disabled:l,loading:l,className:"py-6",children:"Submit"})]})}function Z(){const{data:t,isLoading:s}=L(j.publicPlaylists);return e.jsxs("div",{children:[s&&e.jsx(q,{}),e.jsx("ul",{children:Array.isArray(t==null?void 0:t.data)&&t.data.map(a=>e.jsx(ee,{playlist:a},a.id))})]})}function ee({playlist:t={}}){const{title:s,id:a}=t;return e.jsxs("li",{className:"flex items-center justify-between w-full my-1 duration-75 cursor-pointer hover:bg-slate-950/75 bg-neutral-900/50",children:[e.jsx("p",{className:"m-2",children:s}),e.jsx(te,{playlistId:a})]})}function te({playlistId:t}){const[s,a]=x.useState(!1);function l(r){r.preventDefault(),a(!0),v.delete(`/music/playlist/${t}`).then(()=>{I(j.publicPlaylists)}).finally(()=>{a(!1)})}return e.jsx("button",{disabled:s,onClick:l,className:"h-full m-2",children:e.jsx(T,{className:P("text-slate-200",{"animate-pulse":s})})})}function se(){var s,a;const{data:t}=L(j.publicSongs);return console.log({songData:t}),e.jsx("div",{children:e.jsx("ul",{children:Array.isArray((s=t==null?void 0:t.data)==null?void 0:s.songs)&&((a=t==null?void 0:t.data)==null?void 0:a.songs.map(l=>e.jsx(ae,{song:l},l.id)))})})}function ae({song:t={}}){const{title:s,coverArt:a={}}=t;return e.jsxs("li",{className:"flex items-center justify-between my-2 bg-zinc-900/40",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:a.image,height:40,width:40}),e.jsx("p",{className:"ml-1",children:s})]}),e.jsx("div",{children:e.jsx(le,{songId:t.songId})})]})}function le({songId:t}){const[s,a]=x.useState(!1);function l(r){r.preventDefault(),a(!0),v.delete(j.publicSongs+`/${t}`).then(()=>{I(j.publicSongs)}).finally(()=>{a(!1)})}return e.jsx("button",{disabled:s,onClick:l,className:"h-full m-2",children:e.jsx(T,{className:P("text-slate-200",{"animate-pulse":s})})})}const w=(t="")=>t.replace(/\s*\(.*?\)\s*/g,"").trim();async function re(t,s){var a,l;try{const r=await ne(t,s);if(r.data.recordings.length===0)throw new Error("No recordings found for the given artist and title.");const i=r.data.recordings[0],o=i.releases[0].id,m=await ie(o);return{default:{artist:i["artist-credit"][0].artist.name,title:i.title,album:i.releases[0].title,duration:i.length,releaseDate:i.releases[0].date,coverArt:((l=(a=m==null?void 0:m.data)==null?void 0:a.images)==null?void 0:l[0])||{},releaseID:o,recordingID:i.id},response:r,coverArtResponse:(m==null?void 0:m.data)||{}}}catch(r){console.error("Error fetching song info:",r)}}function ne(t,s){return E.get("https://musicbrainz.org/ws/2/recording/",{params:{query:`artist:${t} AND recording:${s}`,fmt:"json",limit:5}})}function ie(t){return E.get(`https://coverartarchive.org/release/${t}`)}function oe(){const[t,s]=x.useState([]),[a,l]=x.useState(!1),[r,i]=x.useState([]),[o,m]=x.useState([]);function p(c){const n=c.target.files||[];l(!0),B(()=>import("./mediaTags-a6038de0.js"),[]).then(async({readTags:u})=>{for(const f of n)try{await u(f).then(({title:d,artist:g,album:_,year:R,albumArt:k,bpm:z,genre:U})=>{const N={title:w(d),artist:w(g),album:w(_),year:R,albumArt:k,file:f,bpm:z,genre:U};re(N.artist,N.title).then((y={})=>{N.musicBrainz=y.default}).catch(y=>console.error(y)).finally(()=>{s(y=>[...y,N])})})}catch(d){console.log("Failed for",d)}}).catch(u=>{console.log("failed to import readTags",u)}).finally(()=>{l(!1)})}function h(c){c.preventDefault(),Promise.all(t.map(async(n,u)=>{const f=new FormData;return f.append("meta",JSON.stringify({title:n.title,artist:n.artist,album:n.album,year:n.year,bpm:n.bpm,genre:n.genre,musicBrainz:n.musicBrainz})),f.append("file",n.file,n.file.name),i(d=>[...d,u]),v.post("/music/song",f,{headers:{"Content-Type":"multipart/form-data"}}).catch(d=>{var g;return{error:((g=d==null?void 0:d.response)==null?void 0:g.data)||d}}).finally(()=>{i(d=>d.filter(g=>g!==u))})})).then(n=>{const u=[];n.forEach((f,d)=>{f!=null&&f.error&&u.push(d)}),m(u)})}return e.jsxs("div",{className:"p-4 m-4 rounded-lg bg-neutral-600/40 ",children:[e.jsx("h1",{className:"text-xl font-bold text-neutral-300",children:"Upload Song"}),e.jsxs("form",{onSubmit:h,className:"flex flex-col items-center justify-center m-2",children:[e.jsx("input",{type:"file",className:"px-2 py-4 text-center rounded-md bg-neutral-600",onChange:p,multiple:!0,accept:".mp3, .aac,.flac,.wav"}),e.jsx("ul",{className:"overflow-y-auto max-h-[400px] my-4 w-full",children:t.map((c,n)=>e.jsx(ce,{uploading:r.includes(n),hasError:o.includes(n),song:c},c.title))}),e.jsx(A,{disabled:a||!t.length||r.length,className:"m-2 mt-6 px-9",children:"Upload"})]})]})}function ce({song:t,uploading:s,hasError:a}){var m,p,h;const{artist:l,title:r,album:i,musicBrainz:o={}}=t;return e.jsxs("li",{className:P("flex m-2",{"bg-blue-800":s,"bg-red-800":a}),children:[e.jsx("img",{src:((p=(m=o==null?void 0:o.coverArt)==null?void 0:m.thumbnails)==null?void 0:p.small)||((h=o==null?void 0:o.coverArt)==null?void 0:h.image),className:"w-24 h-24"}),e.jsxs("div",{className:"ml-2 text-sm",children:[e.jsx("h5",{children:r}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:r}),e.jsx("h5",{className:"text-xs text-neutral-300",children:l}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:l}),e.jsx("h5",{className:"text-xs text-neutral-300",children:i}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:i})]})]},r)}function S({children:t,className:s,...a}){return e.jsx(O,{className:({isActive:l,isPending:r})=>D(" border-2 text-sm border-gray-700 font-normal text-slate-400 p-2 px-3 m-0 hover:bg-yellow-900/25 duration-150",l&&"bg-red-900/5 text-white font-bold",r&&"bg-gray-900",s),...a,children:t})}function ge(){const{user:t}=Y();return t!=null&&t.iam?e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx(S,{to:"/settings/admin/uploader",children:"Uploader"}),e.jsx(S,{to:"/settings/admin/organizer",children:"Organizer"}),e.jsx(S,{to:"/settings/admin/playlists",children:"Playlists"})]}),e.jsxs(W,{children:[e.jsx(b,{index:!0,element:e.jsx("div",{className:"flex items-center justify-center w-full h-80",children:e.jsx("h1",{className:"text-2xl font-extrabold tracking-wider text-gray-300 uppercase",children:"Let`s Tweak the mood!"})})}),e.jsx(b,{path:"/uploader",Component:oe}),e.jsx(b,{path:"/organizer",Component:se}),e.jsx(b,{path:"/playlists",Component:Q})]})]}):e.jsx(H,{})}export{ge as default};
