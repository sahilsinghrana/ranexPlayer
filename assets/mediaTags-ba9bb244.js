const x=y=>new Promise((d,U)=>{const u=new FileReader;u.onload=function(w){const n=new DataView(w.target.result),i=(c,g,f="iso-8859-1")=>{const o=new Uint8Array(n.buffer,g,c);return new TextDecoder(f).decode(o).replace(/\0/g,"").trim()};if(i(3,0)==="ID3"){const c=n.getUint8(3),g=n.getUint8(5),f=(n.getUint8(6)&127)<<21|(n.getUint8(7)&127)<<14|(n.getUint8(8)&127)<<7|n.getUint8(9)&127;console.log({version:c,flags:g,size:f});let o=10;const r={};for(;o<f+10;){const e=i(4,o);if(!e.trim())break;const t=n.getUint32(o+4),s=new DataView(n.buffer,o+10,t);r[e]=s,o+=10+t}console.log(r);const l=e=>{if(!r[e])return"";const t=r[e],s=t.getUint8(0);let a="iso-8859-1";return s===1?a="utf-16":s===2?a="utf-16be":s===3&&(a="utf-8"),i(t.byteLength-1,t.byteOffset+1,a)},T=l("TIT2"),D=l("TPE1"),h=l("TALB"),p=l("TYER");let m=null;if(r.APIC){const e=r.APIC;let t=1,s="";for(;e.getUint8(t)!==0;)s+=String.fromCharCode(e.getUint8(t)),t++;t++;const a=e.getUint8(t);t++;let b="";for(;e.getUint8(t)!==0;)b+=String.fromCharCode(e.getUint8(t)),t++;t++;const A=new Blob([e.buffer.slice(e.byteOffset+t)],{type:s});m={mimeType:s,pictureType:a,description:b,pictureData:A}}d({title:T,artist:D,album:h,year:p,albumArt:m})}else if(i(3,n.byteLength-128)==="TAG"){const c=n.byteLength-128,g=i(30,c+3),f=i(30,c+33),o=i(30,c+63),r=i(4,c+93);d({title:g,artist:f,album:o,year:r})}else console.log("No ID3 tag"),U(new Error("No ID3 Tag"))},u.readAsArrayBuffer(y)});export{x as readTags};
