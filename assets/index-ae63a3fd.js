import{r as m,j as e,B as D,a as S,m as P,P as O,T as k,c as I,L as q,b as A,d as L,e as J,f as Y,g as E,_ as H,h as K,R as V,i as j}from"./index-3bd92df9.js";import{I as F}from"./Input-6bb17ce4.js";import{F as y}from"./fetchKeys-14f763aa.js";import{M as R}from"./MoonLoader-841332e0.js";import{u as G}from"./useUserProfile-9b864381.js";import Q from"./index-f60c3fbd.js";import"./useIsUserLoggedIn-23108041.js";const C={playlistName:""};function X({onSubmit:t}){const[s,a]=m.useState(C),[l,n]=m.useState(!1),[i,o]=m.useState();function u(h){a(c=>({...c,[h.target.name]:h.target.value}))}function g(h){h.preventDefault(),h.stopPropagation(),s.playlistName&&(n(!0),S.post("/music/playlist",{playlistName:s.playlistName}).then(c=>{var r,x;if(((r=c.data)==null?void 0:r.responseCode)!==1)throw new Error((x=c.data)==null?void 0:x.message);a(C),P(y.publicPlaylists),o(),t&&t(c)}).catch(c=>{o(c.message)}).finally(()=>{n(!1)}))}return e.jsxs("form",{onSubmit:g,className:"flex flex-col justify-center gap-8 mt-4",children:[e.jsxs("div",{children:[e.jsx(F,{className:"bg-slate-500/10 py-4 text-center text-xl",type:"text",name:"playlistName",value:s.playlistName,placeholder:"Playlist Name",maxLength:20,minLength:1,onChange:u,required:!0}),i&&e.jsx("p",{className:"text-sm text-red-700 text-wrap",children:i})]}),e.jsx(D,{disabled:l,loading:l,className:"py-6",children:"Submit"})]})}function Z({onClick:t}){return e.jsxs(D,{onClick:t,className:"px-5 float-right",children:[e.jsx(O,{})," â€‚ Add"]})}function _({playlistId:t}){const[s,a]=m.useState(!1);function l(n){n.preventDefault(),a(!0),S.delete(`/music/playlist/${t}`).then(()=>{P(y.publicPlaylists)}).finally(()=>{a(!1)})}return e.jsx("button",{disabled:s,onClick:l,className:"h-full p-2",children:e.jsx(k,{className:I("text-slate-200",{"animate-pulse":s})})})}function ee({playlist:t={}}){const{title:s,id:a}=t;return e.jsx("li",{children:e.jsxs(q,{className:"flex items-center justify-between w-full my-1 duration-75 cursor-pointer hover:bg-slate-950/75 bg-neutral-900/50",to:String(a),children:[e.jsx("p",{className:"m-2",children:s}),e.jsx(_,{playlistId:a})]})})}function te(){const{data:t,isLoading:s}=A(y.publicPlaylists);return e.jsxs("div",{children:[s&&e.jsx(R,{}),e.jsx("ul",{children:Array.isArray(t==null?void 0:t.data)&&t.data.map(a=>e.jsx(ee,{playlist:a},a.id))})]})}function se({children:t,className:s,...a},l){return e.jsx("dialog",{ref:l,className:L("min-h-64 min-w-80 ",s),...a,children:t})}const ae=m.forwardRef(se);function le({children:t,title:s,classNameTitle:a,...l},n){return e.jsxs(ae,{ref:n,...l,children:[e.jsxs("div",{className:L("relative font-bold w-full py-2 text-xl text-center text-slate-300 tracking-wide bg-slate-800/50",a),children:[s,e.jsx("button",{onClick:()=>n.current.close(),className:"absolute top-0 right-0 flex items-center h-full mr-2 text-xl",children:e.jsx(J,{className:"w-6 h-6 hover:text-red-600"})})]}),t]})}const z=m.forwardRef(le);function ne(){const t=m.useRef();return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"w-full m-3",children:[e.jsx(F,{type:"search",placeholder:"ðŸ”Ž search"}),e.jsx(Z,{onClick:()=>{t.current.showModal()}})]}),e.jsx(z,{className:"p-5 bg-zinc-950",classNameTitle:"bg-transparent",title:"Add Playlist",ref:t,children:e.jsx(X,{onSubmit:()=>t.current.close()})}),e.jsx(te,{})]})}function re(){return e.jsx("div",{children:"LInk Song With Button"})}function ie({playlistId:t}){var n;const s=m.useRef(),a=()=>s.current.showModal(),l=()=>s.current.close();return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:(n=s.current)!=null&&n.open?l:a,type:"button",className:"p-2",children:"+ Add Song"}),e.jsx(z,{className:"p-5 bg-zinc-950",classNameTitle:"bg-transparent",title:"Link Song",ref:s,children:e.jsx(re,{playlistId:t})})]})}function oe(){const t=Y();console.log({params:t});const s=t.playlistId,{data:a={},error:l,isLoading:n}=A(`/music/playlist/${s}`);if(n)return e.jsx(R,{});const{title:i}=a.data||{};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-sm text-gray-400",children:["Playlist: ",e.jsx("b",{className:"text-xl text-gray-100",children:i})," ",e.jsxs("span",{className:"text-xs",children:["(",s]}),")"]}),e.jsxs("ul",{className:"flex list-style-none",children:[e.jsx(T,{children:e.jsx(ie,{})}),e.jsx(T,{children:e.jsx(_,{playlistId:s})})]})]}),l&&e.jsx("pre",{className:"text-red-500",children:JSON.stringify(l,null,2)})]})}function T({children:t}){return e.jsx("li",{className:"border m-1 border-gray-200/10 hover:border-gray-200/50",children:t})}function ce(){var s,a;const{data:t}=A(y.publicSongs);return console.log({songData:t}),e.jsx("div",{children:e.jsx("ul",{children:Array.isArray((s=t==null?void 0:t.data)==null?void 0:s.songs)&&((a=t==null?void 0:t.data)==null?void 0:a.songs.map(l=>e.jsx(de,{song:l},l.id)))})})}function de({song:t={}}){const{title:s,coverArt:a={}}=t;return e.jsxs("li",{className:"flex items-center justify-between my-2 bg-zinc-900/40",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("img",{src:a.image,height:40,width:40}),e.jsx("p",{className:"ml-1",children:s})]}),e.jsx("div",{children:e.jsx(ue,{songId:t.songId})})]})}function ue({songId:t}){const[s,a]=m.useState(!1);function l(n){n.preventDefault(),a(!0),S.delete(y.publicSongs+`/${t}`).then(()=>{P(y.publicSongs)}).finally(()=>{a(!1)})}return e.jsx("button",{disabled:s,onClick:l,className:"h-full m-2",children:e.jsx(k,{className:I("text-slate-200",{"animate-pulse":s})})})}const v=(t="")=>t.replace(/\s*\(.*?\)\s*/g,"").trim();async function me(t,s){var a,l;try{const n=await xe(t,s);if(n.data.recordings.length===0)throw new Error("No recordings found for the given artist and title.");const i=n.data.recordings[0],o=i.releases[0].id,u=await he(o);return{default:{artist:i["artist-credit"][0].artist.name,title:i.title,album:i.releases[0].title,duration:i.length,releaseDate:i.releases[0].date,coverArt:((l=(a=u==null?void 0:u.data)==null?void 0:a.images)==null?void 0:l[0])||{},releaseID:o,recordingID:i.id},response:n,coverArtResponse:(u==null?void 0:u.data)||{}}}catch(n){console.error("Error fetching song info:",n)}}function xe(t,s){return E.get("https://musicbrainz.org/ws/2/recording/",{params:{query:`artist:${t} AND recording:${s}`,fmt:"json",limit:5}})}function he(t){return E.get(`https://coverartarchive.org/release/${t}`)}function fe(){const[t,s]=m.useState([]),[a,l]=m.useState(!1),[n,i]=m.useState([]),[o,u]=m.useState([]);function g(c){const r=c.target.files||[];l(!0),H(()=>import("./mediaTags-a6038de0.js"),[]).then(async({readTags:x})=>{for(const f of r)try{await x(f).then(({title:d,artist:p,album:B,year:U,albumArt:$,bpm:M,genre:W})=>{const b={title:v(d),artist:v(p),album:v(B),year:U,albumArt:$,file:f,bpm:M,genre:W};me(b.artist,b.title).then((N={})=>{b.musicBrainz=N.default}).catch(N=>console.error(N)).finally(()=>{s(N=>[...N,b])})})}catch(d){console.log("Failed for",d)}}).catch(x=>{console.log("failed to import readTags",x)}).finally(()=>{l(!1)})}function h(c){c.preventDefault(),Promise.all(t.map(async(r,x)=>{const f=new FormData;return f.append("meta",JSON.stringify({title:r.title,artist:r.artist,album:r.album,year:r.year,bpm:r.bpm,genre:r.genre,musicBrainz:r.musicBrainz})),f.append("file",r.file,r.file.name),i(d=>[...d,x]),S.post("/music/song",f,{headers:{"Content-Type":"multipart/form-data"}}).catch(d=>{var p;return{error:((p=d==null?void 0:d.response)==null?void 0:p.data)||d}}).finally(()=>{i(d=>d.filter(p=>p!==x))})})).then(r=>{const x=[];r.forEach((f,d)=>{f!=null&&f.error&&x.push(d)}),u(x)})}return e.jsxs("div",{className:"p-4 m-4 rounded-lg bg-neutral-600/40 ",children:[e.jsx("h1",{className:"text-xl font-bold text-neutral-300",children:"Upload Song"}),e.jsxs("form",{onSubmit:h,className:"flex flex-col items-center justify-center m-2",children:[e.jsx("input",{type:"file",className:"px-2 py-4 text-center rounded-md bg-neutral-600",onChange:g,multiple:!0,accept:".mp3, .aac,.flac,.wav"}),e.jsx("ul",{className:"overflow-y-auto max-h-[400px] my-4 w-full",children:t.map((c,r)=>e.jsx(ge,{uploading:n.includes(r),hasError:o.includes(r),song:c},c.title))}),e.jsx(D,{disabled:a||!t.length||n.length,className:"m-2 mt-6 px-9",children:"Upload"})]})]})}function ge({song:t,uploading:s,hasError:a}){var u,g,h;const{artist:l,title:n,album:i,musicBrainz:o={}}=t;return e.jsxs("li",{className:I("flex m-2",{"bg-blue-800":s,"bg-red-800":a}),children:[e.jsx("img",{src:((g=(u=o==null?void 0:o.coverArt)==null?void 0:u.thumbnails)==null?void 0:g.small)||((h=o==null?void 0:o.coverArt)==null?void 0:h.image),className:"w-24 h-24"}),e.jsxs("div",{className:"ml-2 text-sm",children:[e.jsx("h5",{children:n}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:n}),e.jsx("h5",{className:"text-xs text-neutral-300",children:l}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:l}),e.jsx("h5",{className:"text-xs text-neutral-300",children:i}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:i})]})]},n)}function w({children:t,className:s,...a}){return e.jsx(K,{className:({isActive:l,isPending:n})=>L(" border-2 text-sm border-gray-700 font-normal text-slate-400 p-2 px-3 m-0 hover:bg-yellow-900/25 duration-150",l&&"bg-red-900/5 text-white font-bold",n&&"bg-gray-900",s),...a,children:t})}function we(){const{user:t}=G();return t!=null&&t.iam?e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx(w,{to:"/settings/admin/uploader",children:"Uploader"}),e.jsx(w,{to:"/settings/admin/organizer",children:"Organizer"}),e.jsx(w,{to:"/settings/admin/playlists",children:"Playlists"})]}),e.jsxs(V,{children:[e.jsx(j,{index:!0,element:e.jsx("div",{className:"flex items-center justify-center w-full h-80",children:e.jsx("h1",{className:"text-2xl font-extrabold tracking-wider text-gray-300 uppercase",children:"Let`s Tweak the mood!"})})}),e.jsx(j,{path:"/uploader",Component:fe}),e.jsx(j,{path:"/organizer",Component:ce}),e.jsxs(j,{path:"/playlists",children:[e.jsx(j,{Component:ne,index:!0}),e.jsx(j,{Component:oe,path:":playlistId"})]})]})]}):e.jsx(Q,{})}export{we as default};
