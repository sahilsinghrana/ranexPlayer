import{j as e,r as x,_ as F,k as T,R as k,d as N}from"./index-3ca11528.js";import{c as w,B as S,a as D,b as z,d as U}from"./App-78cc889f.js";import{a as _,P as L}from"./react-icons.esm-cb8541b4.js";import{I as P}from"./Input-98084377.js";import{u as O}from"./useUserProfile-c542af5f.js";import $ from"./index-b005440d.js";import"./useIsUserLoggedIn-b3c7f05b.js";function M(){return e.jsx("div",{children:"I am organizer"})}function B({children:t,className:r,...l},n){return e.jsx("dialog",{ref:n,className:w("h-64 w-80 ",r),...l,children:t})}const W=x.forwardRef(B);function q({children:t,title:r,classNameTitle:l,...n},s){return e.jsxs(W,{ref:s,...n,children:[e.jsxs("div",{className:w("relative font-bold w-full py-2 text-xl text-center text-slate-300 tracking-wide bg-slate-800/50",l),children:[r,e.jsx("button",{onClick:()=>s.current.close(),className:"absolute top-0 right-0 flex items-center h-full mr-2 text-xl",children:e.jsx(_,{className:"w-6 h-6 hover:text-red-600"})})]}),t]})}const J=x.forwardRef(q);function V(){const t=x.useRef();return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"w-full m-3",children:[e.jsx(P,{type:"search",placeholder:"ðŸ”Ž search"}),e.jsxs(S,{onClick:()=>{t.current.showModal()},className:"px-5 float-right",children:[e.jsx(L,{})," â€‚ Add"]})]}),e.jsx(J,{onSubmit:()=>t.current.close(),className:"p-5 bg-zinc-950",classNameTitle:"bg-transparent",title:"Add Playlist",ref:t,children:e.jsx(G,{})})]})}function G({onSubmit:t}){function r(l){l.preventDefault(),t&&t()}return e.jsxs("form",{onSubmit:r,className:"flex flex-col justify-center gap-8 mt-4",children:[e.jsx(P,{className:"bg-slate-500/10 py-5 text-center text-2xl",type:"text",placeholder:"Playlist Name",maxLength:20}),e.jsx(S,{className:"bg-slate-500/20 py-6",children:"Submit"})]})}const y=(t="")=>t.replace(/\s*\(.*?\)\s*/g,"").trim();async function H(t,r){var l,n;try{const s=await K(t,r);if(s.data.recordings.length===0)throw new Error("No recordings found for the given artist and title.");const o=s.data.recordings[0],c=o.releases[0].id,d=await Q(c);return{default:{artist:o["artist-credit"][0].artist.name,title:o.title,album:o.releases[0].title,duration:o.length,releaseDate:o.releases[0].date,coverArt:((n=(l=d==null?void 0:d.data)==null?void 0:l.images)==null?void 0:n[0])||{},releaseID:c,recordingID:o.id},response:s,coverArtResponse:(d==null?void 0:d.data)||{}}}catch(s){console.error("Error fetching song info:",s)}}function K(t,r){return D.get("https://musicbrainz.org/ws/2/recording/",{params:{query:`artist:${t} AND recording:${r}`,fmt:"json",limit:5}})}function Q(t){return D.get(`https://coverartarchive.org/release/${t}`)}function X(){const[t,r]=x.useState([]),[l,n]=x.useState(!1),[s,o]=x.useState([]),[c,d]=x.useState([]);function p(h){const a=h.target.files||[];n(!0),F(()=>import("./mediaTags-a6038de0.js"),[]).then(async({readTags:u})=>{for(const m of a)try{await u(m).then(({title:i,artist:f,album:A,year:I,albumArt:C,bpm:R,genre:E})=>{const b={title:y(i),artist:y(f),album:y(A),year:I,albumArt:C,file:m,bpm:R,genre:E};H(b.artist,b.title).then((g={})=>{b.musicBrainz=g.default}).catch(g=>console.error(g)).finally(()=>{r(g=>[...g,b])})})}catch(i){console.log("Failed for",i)}}).catch(u=>{console.log("failed to import readTags",u)}).finally(()=>{n(!1)})}function j(h){h.preventDefault(),Promise.all(t.map(async(a,u)=>{const m=new FormData;return m.append("meta",JSON.stringify({title:a.title,artist:a.artist,album:a.album,year:a.year,bpm:a.bpm,genre:a.genre,musicBrainz:a.musicBrainz})),m.append("file",a.file,a.file.name),o(i=>[...i,u]),U.post("/music/song",m,{headers:{"Content-Type":"multipart/form-data"}}).catch(i=>{var f;return{error:((f=i==null?void 0:i.response)==null?void 0:f.data)||i}}).finally(()=>{o(i=>i.filter(f=>f!==u))})})).then(a=>{const u=[];a.forEach((m,i)=>{m!=null&&m.error&&u.push(i)}),d(u)})}return e.jsxs("div",{className:"p-4 m-4 rounded-lg bg-neutral-600/40 ",children:[e.jsx("h1",{className:"text-xl font-bold text-neutral-300",children:"Upload Song"}),e.jsxs("form",{onSubmit:j,className:"flex flex-col items-center justify-center m-2",children:[e.jsx("input",{type:"file",className:"px-2 py-4 text-center rounded-md bg-neutral-600",onChange:p,multiple:!0,accept:".mp3, .aac,.flac,.wav"}),e.jsx("ul",{className:"overflow-y-auto max-h-[400px] my-4 w-full",children:t.map((h,a)=>e.jsx(Y,{uploading:s.includes(a),hasError:c.includes(a),song:h},h.title))}),e.jsx(S,{disabled:l||!t.length||s.length,className:"m-2 mt-6 px-9",children:"Upload"})]})]})}function Y({song:t,uploading:r,hasError:l}){var d,p,j;const{artist:n,title:s,album:o,musicBrainz:c={}}=t;return e.jsxs("li",{className:z("flex m-2",{"bg-blue-800":r,"bg-red-800":l}),children:[e.jsx("img",{src:((p=(d=c==null?void 0:c.coverArt)==null?void 0:d.thumbnails)==null?void 0:p.small)||((j=c==null?void 0:c.coverArt)==null?void 0:j.image),className:"w-24 h-24"}),e.jsxs("div",{className:"ml-2 text-sm",children:[e.jsx("h5",{children:s}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:s}),e.jsx("h5",{className:"text-xs text-neutral-300",children:n}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:n}),e.jsx("h5",{className:"text-xs text-neutral-300",children:o}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:o})]})]},s)}function v({children:t,className:r,...l}){return e.jsx(T,{className:({isActive:n,isPending:s})=>w(" border-2 text-sm border-gray-700 font-normal text-slate-400 p-2 px-3 m-0 hover:bg-yellow-900/25 duration-150",n&&"bg-red-900/5 text-white font-bold",s&&"bg-gray-900",r),...l,children:t})}function ne(){const{user:t}=O();return t!=null&&t.iam?e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx(v,{to:"/settings/admin/uploader",children:"Uploader"}),e.jsx(v,{to:"/settings/admin/organizer",children:"Organizer"}),e.jsx(v,{to:"/settings/admin/playlists",children:"Playlists"})]}),e.jsxs(k,{children:[e.jsx(N,{index:!0,element:e.jsx("div",{className:"flex items-center justify-center w-full h-80",children:e.jsx("h1",{className:"text-2xl font-extrabold tracking-wider text-gray-300 uppercase",children:"Let`s Tweak the mood!"})})}),e.jsx(N,{path:"/uploader",Component:X}),e.jsx(N,{path:"/organizer",Component:M}),e.jsx(N,{path:"/playlists",Component:V})]})]}):e.jsx($,{})}export{ne as default};
