var v=Object.defineProperty;var b=(a,t,s)=>t in a?v(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var E=(a,t,s)=>(b(a,typeof t!="symbol"?t+"":t,s),s);import{g as P}from"./moonAndMusicImages-40a4352e.js";import{p as i,b as o,a as n,d as m,e as f,f as I,c as M}from"./playerAtom-712d38b1.js";import{c as w}from"./imageHelpers-8dffa84a.js";const D=()=>"mediaSession"in navigator,T=()=>navigator.mediaSession,S=a=>{D()&&(T().playbackState=a)};class k{constructor(){E(this,"seek",t=>{this.audioEl.currentTime=t});this.audioEl=new Audio,this.meta={}}attachListener(t,s){this.audioEl.addEventListener(t,s)}load(t,s={}){this.audioEl.src=t,this.audioEl.load(),this.meta={...this.meta,...s}}loadAndPlay(t,s={}){this.load(t),this.audioEl.play(),this.meta={...this.meta,...s}}play(){this.audioEl.play(),S("playing")}pause(){this.audioEl.pause(),S("paused")}changeVolume(t=0){this.audioEl.volume=t}}const e=new k;e.attachListener("playing",()=>{i.set(o,()=>n.PLAYING)});e.attachListener("pause",()=>{i.set(o,()=>n.PAUSED)});e.attachListener("ended",()=>{i.set(o,()=>n.STOPPED)});e.attachListener("durationchange",()=>{i.set(m,(a={})=>({...a,meta:{...a.meta||{},duration:e.audioEl.duration}}))});e.attachListener("timeupdate",()=>{i.set(m,(a={})=>({meta:{...a.meta||{},currentTime:e.audioEl.currentTime}}))});e.attachListener("onvolumechange",()=>{i.set(f,()=>e.audioEl.volume)});e.attachListener("loadstart",()=>{var s,l,u,c,d,h,g,p,A,y;i.set(o,()=>n.LOADED);const a=P(),t=((u=(l=(s=e.meta)==null?void 0:s.coverArt)==null?void 0:l.thumbnails)==null?void 0:u.small)||((h=(d=(c=e.meta)==null?void 0:c.coverArt)==null?void 0:d.thumbnails)==null?void 0:h.large)||a;if(i.set(I,{image:((p=(g=e.meta)==null?void 0:g.coverArt)==null?void 0:p.image)||t||a,thumbnail:t||((y=(A=e.meta)==null?void 0:A.coverArt)==null?void 0:y.image)||a}),t){const r=new Image;r.src=t,r.crossOrigin="anonymous",r.onload=()=>{const L=w(r);i.set(M,L)}}i.set(m,(r={})=>({meta:{...r.meta||{},...e.meta||{}}}))});export{e as p};
