import{r as x,j as e,_ as F,k,R as z,d as N}from"./index-9fefbbc4.js";import{c as w,a as U,B as S,P as M,u as $,T as O,b as A,d as D,e as P}from"./App-c44bc96d.js";import{I as C}from"./Input-4fee4ade.js";import{M as B}from"./MoonLoader-86f79c15.js";import{u as W}from"./useUserProfile-1a92db1b.js";import q from"./index-2b6844ce.js";import"./useIsUserLoggedIn-563c2195.js";function J({children:t,className:a,...s},l){return e.jsx("dialog",{ref:l,className:w("min-h-64 min-w-80 ",a),...s,children:t})}const V=x.forwardRef(J);function Y({children:t,title:a,classNameTitle:s,...l},r){return e.jsxs(V,{ref:r,...l,children:[e.jsxs("div",{className:w("relative font-bold w-full py-2 text-xl text-center text-slate-300 tracking-wide bg-slate-800/50",s),children:[a,e.jsx("button",{onClick:()=>r.current.close(),className:"absolute top-0 right-0 flex items-center h-full mr-2 text-xl",children:e.jsx(U,{className:"w-6 h-6 hover:text-red-600"})})]}),t]})}const G=x.forwardRef(Y);function H(){const t=x.useRef();return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"w-full m-3",children:[e.jsx(C,{type:"search",placeholder:"ðŸ”Ž search"}),e.jsxs(S,{onClick:()=>{t.current.showModal()},className:"px-5 float-right",children:[e.jsx(M,{})," â€‚ Add"]})]}),e.jsx(G,{className:"p-5 bg-zinc-950",classNameTitle:"bg-transparent",title:"Add Playlist",ref:t,children:e.jsx(K,{onSubmit:()=>t.current.close()})}),e.jsx(Q,{})]})}const I={playlistName:""};function K({onSubmit:t}){const[a,s]=x.useState(I),[l,r]=x.useState(!1),[i,c]=x.useState();function m(h){s(o=>({...o,[h.target.name]:h.target.value}))}function p(h){h.preventDefault(),h.stopPropagation(),a.playlistName&&(r(!0),D.post("/music/playlist",{playlistName:a.playlistName}).then(o=>{var n,u;if(console.log(o),((n=o.data)==null?void 0:n.responseCode)!==1)throw new Error((u=o.data)==null?void 0:u.message);s(I),c(),t&&t(o)}).catch(o=>{c(o.message)}).finally(()=>{r(!1)}))}return console.log({error:i,loading:l}),e.jsxs("form",{onSubmit:p,className:"flex flex-col justify-center gap-8 mt-4",children:[e.jsxs("div",{children:[e.jsx(C,{className:"bg-slate-500/10 py-4 text-center text-xl",type:"text",name:"playlistName",value:a.playlistName,placeholder:"Playlist Name",maxLength:20,minLength:1,onChange:m,required:!0}),i&&e.jsx("p",{className:"text-sm text-red-700 text-wrap",children:i})]}),e.jsx(S,{disabled:l,loading:l,className:"py-6",children:"Submit"})]})}function Q(){const{data:t,isLoading:a}=$("/music/playlist");return console.log({data:t,isLoading:a}),e.jsxs("div",{children:[a&&e.jsx(B,{}),e.jsx("ul",{children:Array.isArray(t==null?void 0:t.data)&&t.data.map(s=>e.jsx(X,{playlist:s},s.id))})]})}function X({playlist:t={}}){const{title:a,id:s}=t;return e.jsxs("li",{className:"flex items-center justify-between w-full my-1 duration-75 cursor-pointer hover:bg-slate-950/75 bg-neutral-900/50",children:[e.jsx("p",{className:"m-2",children:a}),e.jsx(Z,{playlistId:s})]})}function Z({playlistId:t}){const[a,s]=x.useState(!1);function l(r){r.preventDefault(),s(!0),D.delete(`/music/playlist/${t}`).finally(()=>{s(!1)})}return e.jsx("button",{disabled:a,onClick:l,className:"h-full m-2",children:e.jsx(O,{className:A("text-slate-200",{"animate-pulse":a})})})}function ee(){return e.jsx("div",{children:"I am organizer"})}const b=(t="")=>t.replace(/\s*\(.*?\)\s*/g,"").trim();async function te(t,a){var s,l;try{const r=await ae(t,a);if(r.data.recordings.length===0)throw new Error("No recordings found for the given artist and title.");const i=r.data.recordings[0],c=i.releases[0].id,m=await se(c);return{default:{artist:i["artist-credit"][0].artist.name,title:i.title,album:i.releases[0].title,duration:i.length,releaseDate:i.releases[0].date,coverArt:((l=(s=m==null?void 0:m.data)==null?void 0:s.images)==null?void 0:l[0])||{},releaseID:c,recordingID:i.id},response:r,coverArtResponse:(m==null?void 0:m.data)||{}}}catch(r){console.error("Error fetching song info:",r)}}function ae(t,a){return P.get("https://musicbrainz.org/ws/2/recording/",{params:{query:`artist:${t} AND recording:${a}`,fmt:"json",limit:5}})}function se(t){return P.get(`https://coverartarchive.org/release/${t}`)}function re(){const[t,a]=x.useState([]),[s,l]=x.useState(!1),[r,i]=x.useState([]),[c,m]=x.useState([]);function p(o){const n=o.target.files||[];l(!0),F(()=>import("./mediaTags-a6038de0.js"),[]).then(async({readTags:u})=>{for(const f of n)try{await u(f).then(({title:d,artist:g,album:L,year:T,albumArt:E,bpm:R,genre:_})=>{const y={title:b(d),artist:b(g),album:b(L),year:T,albumArt:E,file:f,bpm:R,genre:_};te(y.artist,y.title).then((j={})=>{y.musicBrainz=j.default}).catch(j=>console.error(j)).finally(()=>{a(j=>[...j,y])})})}catch(d){console.log("Failed for",d)}}).catch(u=>{console.log("failed to import readTags",u)}).finally(()=>{l(!1)})}function h(o){o.preventDefault(),Promise.all(t.map(async(n,u)=>{const f=new FormData;return f.append("meta",JSON.stringify({title:n.title,artist:n.artist,album:n.album,year:n.year,bpm:n.bpm,genre:n.genre,musicBrainz:n.musicBrainz})),f.append("file",n.file,n.file.name),i(d=>[...d,u]),D.post("/music/song",f,{headers:{"Content-Type":"multipart/form-data"}}).catch(d=>{var g;return{error:((g=d==null?void 0:d.response)==null?void 0:g.data)||d}}).finally(()=>{i(d=>d.filter(g=>g!==u))})})).then(n=>{const u=[];n.forEach((f,d)=>{f!=null&&f.error&&u.push(d)}),m(u)})}return e.jsxs("div",{className:"p-4 m-4 rounded-lg bg-neutral-600/40 ",children:[e.jsx("h1",{className:"text-xl font-bold text-neutral-300",children:"Upload Song"}),e.jsxs("form",{onSubmit:h,className:"flex flex-col items-center justify-center m-2",children:[e.jsx("input",{type:"file",className:"px-2 py-4 text-center rounded-md bg-neutral-600",onChange:p,multiple:!0,accept:".mp3, .aac,.flac,.wav"}),e.jsx("ul",{className:"overflow-y-auto max-h-[400px] my-4 w-full",children:t.map((o,n)=>e.jsx(le,{uploading:r.includes(n),hasError:c.includes(n),song:o},o.title))}),e.jsx(S,{disabled:s||!t.length||r.length,className:"m-2 mt-6 px-9",children:"Upload"})]})]})}function le({song:t,uploading:a,hasError:s}){var m,p,h;const{artist:l,title:r,album:i,musicBrainz:c={}}=t;return e.jsxs("li",{className:A("flex m-2",{"bg-blue-800":a,"bg-red-800":s}),children:[e.jsx("img",{src:((p=(m=c==null?void 0:c.coverArt)==null?void 0:m.thumbnails)==null?void 0:p.small)||((h=c==null?void 0:c.coverArt)==null?void 0:h.image),className:"w-24 h-24"}),e.jsxs("div",{className:"ml-2 text-sm",children:[e.jsx("h5",{children:r}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:r}),e.jsx("h5",{className:"text-xs text-neutral-300",children:l}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:l}),e.jsx("h5",{className:"text-xs text-neutral-300",children:i}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:i})]})]},r)}function v({children:t,className:a,...s}){return e.jsx(k,{className:({isActive:l,isPending:r})=>w(" border-2 text-sm border-gray-700 font-normal text-slate-400 p-2 px-3 m-0 hover:bg-yellow-900/25 duration-150",l&&"bg-red-900/5 text-white font-bold",r&&"bg-gray-900",a),...s,children:t})}function xe(){const{user:t}=W();return t!=null&&t.iam?e.jsxs("div",{children:[e.jsxs("div",{className:"flex",children:[e.jsx(v,{to:"/settings/admin/uploader",children:"Uploader"}),e.jsx(v,{to:"/settings/admin/organizer",children:"Organizer"}),e.jsx(v,{to:"/settings/admin/playlists",children:"Playlists"})]}),e.jsxs(z,{children:[e.jsx(N,{index:!0,element:e.jsx("div",{className:"flex items-center justify-center w-full h-80",children:e.jsx("h1",{className:"text-2xl font-extrabold tracking-wider text-gray-300 uppercase",children:"Let`s Tweak the mood!"})})}),e.jsx(N,{path:"/uploader",Component:re}),e.jsx(N,{path:"/organizer",Component:ee}),e.jsx(N,{path:"/playlists",Component:H})]})]}):e.jsx(q,{})}export{xe as default};
