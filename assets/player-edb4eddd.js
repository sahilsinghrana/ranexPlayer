var v=Object.defineProperty;var b=(a,t,s)=>t in a?v(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var E=(a,t,s)=>(b(a,typeof t!="symbol"?t+"":t,s),s);import{g as P}from"./moonAndMusicImages-40a4352e.js";import{p as r,b as o,a as n,d as l,e as f,f as I,c as M}from"./playerAtom-a57d48cd.js";import{c as D}from"./imageHelpers-8dffa84a.js";const w=()=>"mediaSession"in navigator,O=()=>navigator.mediaSession,L=a=>{w()&&(O().playbackState=a)};class T{constructor(){E(this,"seek",t=>{this.audioEl.currentTime=t});this.audioEl=new Audio,this.meta={}}attachListener(t,s){this.audioEl.addEventListener(t,s)}load(t,s={}){this.audioEl.src=t,this.audioEl.load(),this.meta={...this.meta,...s}}loadAndPlay(t,s={}){this.load(t),this.audioEl.play(),this.meta={...this.meta,...s}}play(){this.audioEl.play(),L("playing")}pause(){this.audioEl.pause(),L("paused")}changeVolume(t=0){this.audioEl.volume=t}}const e=new T;e.attachListener("loadeddata",()=>{r.set(o,()=>n.LOADED)});e.attachListener("playing",()=>{r.set(o,()=>n.PLAYING)});e.attachListener("pause",()=>{r.set(o,()=>n.PAUSED)});e.attachListener("ended",()=>{r.set(o,()=>n.STOPPED)});e.attachListener("durationchange",()=>{r.set(l,(a={})=>({...a,meta:{...a.meta||{},duration:e.audioEl.duration}}))});e.attachListener("timeupdate",()=>{r.set(l,(a={})=>({meta:{...a.meta||{},currentTime:e.audioEl.currentTime}}))});e.attachListener("onvolumechange",()=>{r.set(f,()=>e.audioEl.volume)});e.attachListener("loadstart",()=>{var s,m,u,c,d,h,g,p,A,y;console.log("Load Start"),r.set(o,()=>n.LOADING);const a=P(),t=((u=(m=(s=e.meta)==null?void 0:s.coverArt)==null?void 0:m.thumbnails)==null?void 0:u.small)||((h=(d=(c=e.meta)==null?void 0:c.coverArt)==null?void 0:d.thumbnails)==null?void 0:h.large)||a;if(r.set(I,{image:((p=(g=e.meta)==null?void 0:g.coverArt)==null?void 0:p.image)||t||a,thumbnail:t||((y=(A=e.meta)==null?void 0:A.coverArt)==null?void 0:y.image)||a}),t){const i=new Image;i.src=t,i.crossOrigin="anonymous",i.onload=()=>{const S=D(i);r.set(M,S)}}r.set(l,(i={})=>({meta:{...i.meta||{},...e.meta||{}}}))});export{e as p};
