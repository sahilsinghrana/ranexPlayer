var f=Object.defineProperty;var v=(e,t,a)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var d=(e,t,a)=>(v(e,typeof t!="symbol"?t+"":t,a),a);import{g as P}from"./moonAndMusicImages-ee3f4190.js";import{p as n,b as o,a as r,d as g,e as I,f as M,c as C}from"./playerAtom-e99d3d84.js";import{c as h}from"./helpers-b6ef1e89.js";import{c as D}from"./imageHelpers-8dffa84a.js";const T=()=>"mediaSession"in navigator,w=()=>navigator.mediaSession,L=e=>{T()&&(w().playbackState=e)};class O{constructor(){d(this,"listenSongChange");d(this,"seek",t=>{this.audioEl.currentTime=t});this.audioEl=new Audio,this.meta={}}attachListener(t,a){if(t==="songchange"){this.listenSongChange=a;return}this.audioEl.addEventListener(t,a)}load(t,a={}){this.listenSongChange(t,a),this.audioEl.src=t,this.audioEl.load(),this.meta=a}loadAndPlay(t,a={}){this.load(t,a),this.audioEl.play(),this.meta={...this.meta,...a}}play(){this.audioEl.play(),L("playing")}pause(){this.audioEl.pause(),L("paused")}changeVolume(t=0){this.audioEl.volume=t}}const s=new O;s.attachListener("loadeddata",()=>{n.set(o,()=>r.LOADED)});s.attachListener("loadstart",()=>{n.set(o,()=>r.LOADING)});s.attachListener("playing",()=>{n.set(o,()=>r.PLAYING)});s.attachListener("pause",()=>{n.set(o,()=>r.PAUSED)});s.attachListener("ended",()=>{n.set(o,()=>r.STOPPED)});s.attachListener("durationchange",()=>{n.set(g,(e={})=>({...e,meta:{...e.meta||{},duration:s.audioEl.duration}}))});s.attachListener("timeupdate",()=>{n.set(g,(e={})=>({meta:{...e.meta||{},currentTime:s.audioEl.currentTime}}))});s.attachListener("onvolumechange",()=>{n.set(I,()=>s.audioEl.volume)});s.attachListener("songchange",(e,t={})=>{var p,A,y,S,E;n.set(g,(i={})=>({...i,meta:t}));const a=P(),l=h((A=(p=t==null?void 0:t.coverArt)==null?void 0:p.thumbnails)==null?void 0:A.small),u=h((S=(y=t==null?void 0:t.coverArt)==null?void 0:y.thumbnails)==null?void 0:S.large),c=h((E=t==null?void 0:t.coverArt)==null?void 0:E.image),m=l||u||c||a;if(n.set(M,{image:c||u||l||a,thumbnail:l||u||c||a}),m){const i=new Image;i.src=m,i.crossOrigin="anonymous",i.onload=()=>{const b=D(i);n.set(C,b)}}});export{s as p};
