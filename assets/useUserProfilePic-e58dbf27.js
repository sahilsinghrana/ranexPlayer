import{R as be,r as R,f as De}from"./index-1a08429f.js";import{a as me,S as Ce,s as pe,c as Ie,i as n,b as Ae,g as Le,U as ie,d as ue,e as A,f as Oe,u as z,h as ke,I as oe,r as we,j as ce,m as _e}from"./index-c4965f9e.js";const le=be.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(l=>{t.status="fulfilled",t.value=l},l=>{t.status="rejected",t.reason=l}),t)}),G={dedupe:!0},Ne=(t,l,f)=>{const{cache:E,compare:F,suspense:U,fallbackData:Y,revalidateOnMount:L,revalidateIfStale:O,refreshInterval:k,refreshWhenHidden:B,refreshWhenOffline:J,keepPreviousData:fe}=f,[w,de,v,Re]=Ce.get(E),[e,K]=pe(t),x=R.useRef(!1),C=R.useRef(!1),_=R.useRef(e),y=R.useRef(l),M=R.useRef(f),i=()=>M.current,q=()=>i().isVisible()&&i().isOnline(),[T,W,ge,Ee]=Ie(E,e),p=R.useRef({}).current,he=n(Y)?f.fallback[e]:Y,Q=(a,r)=>{for(const o in p){const s=o;if(s==="data"){if(!F(a[s],r[s])&&(!n(a[s])||!F(P,r[s])))return!1}else if(r[s]!==a[s])return!1}return!0},X=R.useMemo(()=>{const a=(()=>!e||!l?!1:n(L)?i().isPaused()||U?!1:n(O)?!0:O:L)(),r=c=>{const h=_e(c);return delete h._k,a?{isValidating:!0,isLoading:!0,...h}:h},o=T(),s=Ee(),g=r(o),m=o===s?g:r(s);let u=g;return[()=>{const c=r(T());return Q(c,u)?(u.data=c.data,u.isLoading=c.isLoading,u.isValidating=c.isValidating,u.error=c.error,u):(u=c,c)},()=>m]},[E,e]),V=Ae.useSyncExternalStore(R.useCallback(a=>ge(e,(r,o)=>{Q(o,r)||a()}),[E,e]),X[0],X[1]),Z=!x.current,Se=w[e]&&w[e].length>0,b=V.data,D=n(b)?he:b,N=V.error,$=R.useRef(D),P=fe?n(b)?$.current:b:D,ee=(()=>Se&&!n(N)?!1:Z&&!n(L)?L:i().isPaused()?!1:U?n(D)?!1:O:n(D)||O)(),te=!!(e&&l&&Z&&ee),ve=n(V.isValidating)?te:V.isValidating,Te=n(V.isLoading)?te:V.isLoading,I=R.useCallback(async a=>{const r=y.current;if(!e||!r||C.current||i().isPaused())return!1;let o,s,g=!0;const m=a||{},u=!v[e]||!m.dedupe,c=()=>ce?!C.current&&e===_.current&&x.current:e===_.current,h={isValidating:!1,isLoading:!1},re=()=>{W(h)},se=()=>{const d=v[e];d&&d[1]===s&&delete v[e]},ne={isValidating:!0};n(T().data)&&(ne.isLoading=!0);try{if(u&&(W(ne),f.loadingTimeout&&n(T().data)&&setTimeout(()=>{g&&c()&&i().onLoadingSlow(e,f)},f.loadingTimeout),v[e]=[r(K),Le()]),[o,s]=v[e],o=await o,u&&setTimeout(se,f.dedupingInterval),!v[e]||v[e][1]!==s)return u&&c()&&i().onDiscarded(e),!1;h.error=ie;const d=de[e];if(!n(d)&&(s<=d[0]||s<=d[1]||d[1]===0))return re(),u&&c()&&i().onDiscarded(e),!1;const S=T().data;h.data=F(S,o)?S:o,u&&c()&&i().onSuccess(o,e,f)}catch(d){se();const S=i(),{shouldRetryOnError:H}=S;S.isPaused()||(h.error=d,u&&c()&&(S.onError(d,e,S),(H===!0||ue(H)&&H(d))&&(!i().revalidateOnFocus||!i().revalidateOnReconnect||q())&&S.onErrorRetry(d,e,S,Ve=>{const j=w[e];j&&j[0]&&j[0](A.ERROR_REVALIDATE_EVENT,Ve)},{retryCount:(m.retryCount||0)+1,dedupe:!0})))}return g=!1,re(),!0},[e,E]),ae=R.useCallback((...a)=>Oe(E,_.current,...a),[]);if(z(()=>{y.current=l,M.current=f,n(b)||($.current=b)}),z(()=>{if(!e)return;const a=I.bind(ie,G);let r=0;const s=ke(e,w,(g,m={})=>{if(g==A.FOCUS_EVENT){const u=Date.now();i().revalidateOnFocus&&u>r&&q()&&(r=u+i().focusThrottleInterval,a())}else if(g==A.RECONNECT_EVENT)i().revalidateOnReconnect&&q()&&a();else{if(g==A.MUTATE_EVENT)return I();if(g==A.ERROR_REVALIDATE_EVENT)return I(m)}});return C.current=!1,_.current=e,x.current=!0,W({_k:K}),ee&&(n(D)||oe?a():we(a)),()=>{C.current=!0,s()}},[e]),z(()=>{let a;function r(){const s=ue(k)?k(T().data):k;s&&a!==-1&&(a=setTimeout(o,s))}function o(){!T().error&&(B||i().isVisible())&&(J||i().isOnline())?I(G).then(r):r()}return r(),()=>{a&&(clearTimeout(a),a=-1)}},[k,B,J,e]),R.useDebugValue(P),U&&n(D)&&e){if(!ce&&oe)throw new Error("Fallback data is required when using suspense in SSR.");y.current=l,M.current=f,C.current=!1;const a=Re[e];if(!n(a)){const r=ae(a);le(r)}if(n(N)){const r=I(G);n(P)||(r.status="fulfilled",r.value=!0),le(r)}else throw N}return{mutate:ae,get data(){return p.data=!0,P},get error(){return p.error=!0,N},get isValidating(){return p.isValidating=!0,ve},get isLoading(){return p.isLoading=!0,Te}}},Pe=me(Ne);function Fe(){var E;const{data:t,isLoading:l,error:f}=Pe("/user/profile",De);return{user:(E=t==null?void 0:t.data)==null?void 0:E.data,isLoading:l,error:f}}const Ue="/ranexPlayer/assets/musicalSkull-823a3f35.webp";function Me(){const{user:t}=Fe()||Ue;return(t==null?void 0:t.picture)||(t==null?void 0:t.avatar)}export{Me as a,Fe as u};
