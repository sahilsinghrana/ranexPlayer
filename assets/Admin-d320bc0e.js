import{r as N,j as e,_ as D}from"./index-b9b0afd5.js";import{a as y,B as _,c as I,b as P}from"./App-cd712bf7.js";import{u as U}from"./useUserProfile-e21e35af.js";import C from"./index-1c1318af.js";import"./useIsUserLoggedIn-84f26870.js";const b=(r="")=>r.replace(/\s*\(.*?\)\s*/g,"").trim();async function T(r,c){var u,m;try{const n=await B(r,c);if(n.data.recordings.length===0)throw new Error("No recordings found for the given artist and title.");const s=n.data.recordings[0],l=s.releases[0].id,i=await R(l);return{default:{artist:s["artist-credit"][0].artist.name,title:s.title,album:s.releases[0].title,duration:s.length,releaseDate:s.releases[0].date,coverArt:((m=(u=i==null?void 0:i.data)==null?void 0:u.images)==null?void 0:m[0])||{},releaseID:l,recordingID:s.id},response:n,coverArtResponse:(i==null?void 0:i.data)||{}}}catch(n){console.error("Error fetching song info:",n)}}function B(r,c){return y.get("https://musicbrainz.org/ws/2/recording/",{params:{query:`artist:${r} AND recording:${c}`,fmt:"json",limit:5}})}function R(r){return y.get(`https://coverartarchive.org/release/${r}`)}function J(){const{user:r}=U(),[c,u]=N.useState([]),[m,n]=N.useState(!1),[s,l]=N.useState([]),[i,x]=N.useState([]);if(!(r!=null&&r.iam))return e.jsx(C,{});function g(f){const t=f.target.files||[];n(!0),D(()=>import("./mediaTags-a6038de0.js"),[]).then(async({readTags:d})=>{for(const o of t)try{await d(o).then(({title:a,artist:h,album:S,year:w,albumArt:A,bpm:E,genre:F})=>{const j={title:b(a),artist:b(h),album:b(S),year:w,albumArt:A,file:o,bpm:E,genre:F};T(j.artist,j.title).then((p={})=>{j.musicBrainz=p.default}).catch(p=>console.error(p)).finally(()=>{u(p=>[...p,j])})})}catch(a){console.log("Failed for",a)}}).catch(d=>{console.log("failed to import readTags",d)}).finally(()=>{n(!1)})}function v(f){f.preventDefault(),Promise.all(c.map(async(t,d)=>{const o=new FormData;return o.append("meta",JSON.stringify({title:t.title,artist:t.artist,album:t.album,year:t.year,bpm:t.bpm,genre:t.genre,musicBrainz:t.musicBrainz})),o.append("file",t.file,t.file.name),l(a=>[...a,d]),P.post("/music/song",o,{headers:{"Content-Type":"multipart/form-data"}}).catch(a=>{var h;return{error:((h=a==null?void 0:a.response)==null?void 0:h.data)||a}}).finally(()=>{l(a=>a.filter(h=>h!==d))})})).then(t=>{const d=[];t.forEach((o,a)=>{o!=null&&o.error&&d.push(a)}),x(d)})}return e.jsx("div",{children:e.jsxs("div",{className:"p-4 m-4 rounded-lg bg-neutral-600/40 ",children:[e.jsx("h1",{className:"text-xl font-bold text-neutral-300",children:"Upload Song"}),e.jsxs("form",{onSubmit:v,className:"flex flex-col items-center justify-center m-2",children:[e.jsx("input",{type:"file",className:"px-2 py-4 text-center rounded-md bg-neutral-600",onChange:g,multiple:!0,accept:".mp3, .aac,.flac,.wav"}),e.jsx("ul",{className:"overflow-y-auto max-h-[400px] my-4 w-full",children:c.map((f,t)=>e.jsx($,{uploading:s.includes(t),hasError:i.includes(t),song:f},f.title))}),e.jsx(_,{disabled:m||!c.length||s.length,className:"m-2 mt-6 px-9",children:"Upload"})]})]})})}function $({song:r,uploading:c,hasError:u}){var i,x,g;const{artist:m,title:n,album:s,musicBrainz:l={}}=r;return e.jsxs("li",{className:I("flex m-2",{"bg-blue-800":c,"bg-red-800":u}),children:[e.jsx("img",{src:((x=(i=l==null?void 0:l.coverArt)==null?void 0:i.thumbnails)==null?void 0:x.small)||((g=l==null?void 0:l.coverArt)==null?void 0:g.image),className:"w-24 h-24"}),e.jsxs("div",{className:"ml-2 text-sm",children:[e.jsx("h5",{children:n}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:n}),e.jsx("h5",{className:"text-xs text-neutral-300",children:m}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:m}),e.jsx("h5",{className:"text-xs text-neutral-300",children:s}),e.jsx("h5",{className:"text-[9px] text-neutral-400",children:s})]})]},n)}export{J as default};
