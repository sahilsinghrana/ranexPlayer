const x=y=>new Promise((d,T)=>{const u=new FileReader;u.onload=function(w){const o=new DataView(w.target.result),r=(s,i,c="iso-8859-1")=>{const n=new Uint8Array(o.buffer,i,s);return new TextDecoder(c).decode(n).replace(/\0/g,"").trim()};if(r(3,0)==="ID3"){const s=(o.getUint8(6)&127)<<21|(o.getUint8(7)&127)<<14|(o.getUint8(8)&127)<<7|o.getUint8(9)&127;let i=10;const c={};for(;i<s+10;){const t=r(4,i);if(!t.trim())break;const e=o.getUint32(i+4),f=new DataView(o.buffer,i+10,e);c[t]=f,i+=10+e}const n=t=>{if(!c[t])return"";const e=c[t],f=e.getUint8(0);let a="iso-8859-1";return f===1?a="utf-16":f===2?a="utf-16be":f===3&&(a="utf-8"),r(e.byteLength-1,e.byteOffset+1,a)},g=n("TIT2"),l=n("TPE1"),U=n("TALB"),p=n("TYER"),D=n("TBPM"),h=n("TCON");let m=null;if(c.APIC){const t=c.APIC;let e=1,f="";for(;t.getUint8(e)!==0;)f+=String.fromCharCode(t.getUint8(e)),e++;e++;const a=t.getUint8(e);e++;let b="";for(;t.getUint8(e)!==0;)b+=String.fromCharCode(t.getUint8(e)),e++;e++;const A=new Blob([t.buffer.slice(t.byteOffset+e)],{type:f});m={mimeType:f,pictureType:a,description:b,pictureData:A}}d({title:g,artist:l,album:U,year:p,bpm:D,genre:h,albumArt:m})}else if(r(3,o.byteLength-128)==="TAG"){const s=o.byteLength-128,i=r(30,s+3),c=r(30,s+33),n=r(30,s+63),g=r(4,s+93),l=r(30,s+97);d({title:i,artist:c,album:n,year:g,genre:l})}else console.log("No ID3 tag"),T(new Error("No ID3 Tag"))},u.readAsArrayBuffer(y)});export{x as readTags};
